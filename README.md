# SMStoEFT
Repository for holding code and data for the SMS -> EFT project

## Installation

The following Mathematica packages must be installed (in <home folder>/.Mathematica/Applications)[^1]:

  * [FeynArts,FormCalc,LoopTools](https://feynarts.de/)
  * [FeynRules](https://feynrules.irmp.ucl.ac.be/)
  * [FeynCalc](https://feyncalc.github.io/)
  * [FeynHelpers](https://github.com/FeynCalc/feynhelpers)
  * [Package-X](https://gitlab.com/mule-tools/package-x) (use this [tarball](./packageX.tar.gz))

In addition [MadGraph5](https://launchpad.net/mg5amcnlo) with [Collier](https://collier.hepforge.org/) must also be installed.

## Loop Calculation

The [NLOCT](http://inspirehep.net/record/1300359) package can be used to automatically compute the required
counterterms and finite rational terms for a given model. The results can be exported to a UFO model,
which can then be used by MadGraph5. The calculation of all the counterterms for a full BSM model (SM+NP)
is quite heavy and unstable. In most cases only the QCD corrections are included (diagrams with colored particles
in the loop and/or involving $\alpha_s$ couplings). In order to include loop diagrams generated by New Physics (NP), the following procedure was applied:

  1. The SM sector was limited to QCD (gluons and quarks)
  2. A BSM model was then defined as QCD+NP
  3. The full calculation of counterterms was performed for this QCD+NP model
  4. In parallel, the QCD counterterms were computed for the full SM
  5. Finally the BSM model was defined as the SM+NP and the counterterms from steps 3. and 4. were merged. As a result the BSM model contain all the counterterms for QCD plus corrections from NP

A notebook implementing all of the above steps can be found [here](./mathematicaNBs/SMS-stop-NLO.nb) and additional checks to make sure the counterterms are compatible were made [here](./mathematicaNBs/SMS-stop-NLO-Checks.nb).

The resulting model ready for NLO calculations can be found [here](./Models/SMS-stopNLO/).

### Additional comments

Some of the diagrams generated using FeynArts are zero due to color conservation (see [this notebook](./mathematicaNBs/diagrams-DMEFT-stop.nb)), hence these are not generated by MG5. Also not all diagrams are displayed by the automatically generated HTML pages (make sure to check the postscript files).


## Current issues

The computation of the BSM corrections to ttbar production does not seem reliable. The following issues were found:

  * When increasing the BSM coupling ($y_{DM}$) the QCD+BSM NLO cross-section becomes negative. This happens
    whether the counterterms from BSM loops (proportional to $y_{DM}$) are included or not. Maybe this could be due to the fact that we are not in the perturbative regime. In this case, if the $born\times virtual^*$ interference term is large and negative and the $|virtual|^2$ term (which is even larger) is not included in the calculation, the total cross-section ( $|born|^2 + born \times virtual^* + h.c\,$) would be negative (true?).
  * If only the BSM NLO cross-section is computed (i.e. only BSM loop diagrams are considered), the
    total cross-section seems to be independent of the $y_{DM}$ value. However in this case the cross-section is always positive when one would expect it to reproduce the full calculation for $y_{DM}$ sufficiently large, since it would dominate the terms.
  * The fixed order calculation seems to break.

More tests are needed. There are a few distinct scenarios which can be used to investigate the effects of BSM loops and their counterterms (CTs)[^2]:

  1. BSM CTs + all loops: here we include both QCD and BSM loops as well as the CTs proportional to $\alpha_s$ and $y_{DM}$.
  2. BSM CTs + QCD loops: here we include only QCD loops, but all the CTs proportional to $\alpha_s$ and $y_{DM}$. However, since only QCD loops are included, the BSM CTs are not used in the calculation (true?).
  3. BSM CTs + BSM loops: here we only include BSM loops. As in the previous case, only the BSM CTs are used in the calculation.
  4. QCD CTs + QCD loops: here we neglect BSM loops and CTs. The result should be the same as in case 2.
  5. QCD CTs + all loops: this case should produce wrong results, since the necessary BSM CTs are not available.
  6. QCD CTs + BSM loops: same issue as the previous case.

Cases 1-3 can be studied using the [SMS-stopNLO](./Models/SMS-stopNLO/) model, which includes both the BSM and QCD CTs. However, cases 4-6 should use the [SMS-stop_QCDOnly-NLO](./Models/SMS-stop_QCDOnly-NLO/) model which does not include the BSM CTs.

## Form Factors

### Computing Form Factors

The calculation of form factors can be done using FeynArts, FeynCalc and Package-X (through FeynHelpers).
An example of the calculation of the Higgs-Gluon-Gluon form factor can be found [here](./auxFiles/Examples/feyncalc-HGG.nb).

### Creating Models with Form Factors

Instruction for implementing form factors within MadGraph can be found [here](./InstructionsFormFactors.md). 
These instructions are based on:

 * [MadGraph wiki](https://cp3.irmp.ucl.ac.be/projects/madgraph/wiki/FormFactors)
 * [MadGraph Tutorial](./Refs/Hands-onStartToMG.pdf)
 

   

[^1]: Make sure to include the following lines to <home folder>/Mathematica/Kernel/init.m:

     ```
     $Path = Join[
             {ToFileName[$HomeDirectory, ".Mathematica/Applications/LoopTools/x86_64-Linux/bin"],
             ToFileName[$HomeDirectory, ".Mathematica/Applications/FeynRules"],
             ToFileName[$HomeDirectory, ".Mathematica/Applications/FeynArts"],
             ToFileName[$HomeDirectory, ".Mathematica/Applications/X"]
             }, $Path]

     $FeynRulesPath = SetDirectory[FileNameJoin[{$HomeDirectory, ".Mathematica/Applications/FeynRules"}]];                          
     ```     
[^2]: By BSM loops we mean the loops involving the BSM coupling $y_{DM}$ and by counterterms we mean the R2 and UV terms computed with NLOCT. Note that "QCD" loops also includes stop loops and therefore BSM effects. 